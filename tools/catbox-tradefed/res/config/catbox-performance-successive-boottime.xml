<!--
  ~ Copyright (C) 2022 The Android Open Source Project
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~      http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  -->

<configuration>
    <!-- Extend existing boottime config-->
    <include name="google/test/boottime-successive"/>

    <!-- Build Provider -->
    <build_provider
        class="com.android.compatibility.common.tradefed.build.CompatibilityBuildProvider"/>

    <!-- Target Preparer To Collect Device Info -->
    <target_preparer
        class="com.android.compatibility.common.tradefed.targetprep.DeviceInfoCollector">
        <option name="apk" value="CtsDeviceInfo.apk"/>
        <option name="package" value="com.android.compatibility.common.deviceinfo"/>
        <option name="src-dir" value="/sdcard/device-info-files/"/>
        <option name="dest-dir" value="device-info-files/"/>
        <option name="temp-dir" value="temp-device-info-files/"/>
        <option name="throw-error" value="false"/>
    </target_preparer>

    <!-- Result Reporter -->
    <result_reporter class="com.android.catbox.result.JsonResultReporter">
        <option name="dest-dir" value="report-log-files/"/>
        <option name="test-iteration-separator" value="$"/>
        <option name="aggregate-similar-tests" value="true"/>
    </result_reporter>
    <result_reporter
        class="com.android.compatibility.common.tradefed.result.suite.CertificationSuiteResultReporter"/>
    <!-- Create the zip report last always -->
    <result_reporter class="com.android.compatibility.common.tradefed.result.suite.CertificationReportCreator" />


    <option name="boot-delay" value="20000"/>
    <option name="boot-count" value="20"/>
    <option name="dmesg-info" value="true"/>
    <option name="granular-boot-info" value="true"/>
    <option name="online-timeout" value="120000"/>
    <option name="successive-boot" value="true"/>

    <!-- Prepare commands -->
    <option name="successive-boot-prepare-cmd"
            value="am start -n com.google.android.car.setupwizard/.ExitActivity"/>
    <option name="successive-boot-prepare-cmd"
            value="setprop persist.aae.suw.disable_short_notice true"/>
    <option name="successive-boot-prepare-cmd"
            value="cmd car_service enable-feature car_evs_service"/>

    <!-- For custom boot time metrics -->
    <option name="boot-time-pattern" key="boot_to_ble_on"
            value="BluetoothAdapterService: updateAdapterState\(\) \- Broadcasting state BLE_ON"/>
    <option name="boot-time-pattern" key="boot_to_carlauncher_fully_drawn"
            value="Fully drawn com.android.car.carlauncher/.CarLauncher"/>
    <option name="boot-time-pattern" key="boot_to_first_user_unlocked"
            value="CarServiceHelper: Time to unlock 1st user"/>
    <option name="boot-time-pattern" key="boot_to_maps_displayed"
            value="Displayed com.google.android.apps.maps"/>
    <option name="boot-time-pattern" key="boot_to_settings_fallbackhome_displayed"
            value="Displayed com.android.car.settings/.FallbackHome"/>
    <option name="boot-time-pattern" key="boot_to_user0_unlocked"
            value="SystemServerTiming: SystemUserUnlock took to complete"/>
    <option name="boot-time-pattern" key="boot_to_user10_unlocked"
            value="SystemServerTiming: User10Unlock took to complete"/>
    <option name="boot-time-pattern" key="boot_to_gmscore_started_experimental"
            value="ActivityManager: Start proc \d+:com.google.android.gms/u0"/>
    <option name="boot-time-pattern" key="boot_to_car_evs_service_started"
            value="CAR.InitTiming: CarEvsService took to complete"/>

    <option name="report-log-name" value="CatboxPerformanceTests" />
    <option name="report-test-name-mapping" key="BootTimeTest.BootTimeTest#SuccessiveBootTest" value="boot_time_test" />
    <option name="report-all-metrics" value="false" />
    <option name="report-metric-key-mapping" key="dmesg_action_sys.boot_completed_first_timestamp-median" value="successive_boot_time" />
</configuration>
